<html>

  <head>

    <!-- Import React -->
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>

  <body>
    <script type="text/babel">
      function ProductivityButton (props) {
        return (
          <div className="productivity-button">
            <button onClick={props.click}>Click Me</button>
          </div>
        )
      }

      function Stat (props) {
        return (
          <div className="stats-panel-item">{props.name}: {props.count}</div>
        )
      }

      function Logo (props) {
        return (
          <div className="logo">Productivity Counter</div>
        )
      }

      function StatsPanel (props) {
        return (
          <div className="stats-panel">
            <Logo />
            <Stat name="Tasks" count={props.tasksCount} />
            <Stat name="Productivity" count={props.productivityCount} />
            <Stat name="Legal Pads" count={props.legalPadsCount} />
            <Stat name="Todo Apps" count={props.todoAppsCount} />
            <Stat name="Python Scripts" count={props.pythonScriptsCount} />
            <Stat name="Multitasking" count={props.multitaskingCount} />
            <ProductivityButton click={props.click}/>
          </div>
        )
      }

      function UpgradeItem (props) {
        return (
          <div className="upgrade-item" onClick={ ()=>props.click() }>
            <div className="task-text">{ props.text } (Costs { props.cost() } productivity.)</div>
          </div>
        )
      }

      function UpgradePanel (props) {
        return (
          <div className="upgrade-panel">
            <img src="backdrop.jpg" style={{width: 100 + "%"}}/>

            <UpgradeItem click={ props.buyLegalPad } text="Buy Legal Pad" cost={ props.costLegalPad } />
            <UpgradeItem click={ props.buyTodoApp } text="Install Todo App" cost={ props.costTodoApp } />
            <UpgradeItem click={ props.buyMultitasking } text="Upgrade Multitasking" cost={ props.costMultitasking } />
            <UpgradeItem click={ props.buyPythonScript } text="Build Python Script" cost={ props.costPythonScript } />
          </div>
        )
      }

      class App extends React.Component {
        constructor (props) {
          super(props)
          this.state = {
            tasksCount: 100,
            productivityCount: 100,
            legalPadsCount: 0,
            todoAppsCount: 0,
            pythonScriptsCount: 0,
            multitaskingCount: 0,
          }
          this.tick = this.tick.bind(this)
          this.click = this.click.bind(this)

          /* bind buy functions */
          this.buyLegalPad = this.buyLegalPad.bind(this)
          this.buyTodoApp = this.buyTodoApp.bind(this)
          this.buyMultitasking = this.buyMultitasking.bind(this)
          this.buyPythonScript = this.buyPythonScript.bind(this)
          /* bind cost functions */
          this.costLegalPad = this.costLegalPad.bind(this)
          this.costTodoApp = this.costTodoApp.bind(this)
          this.costMultitasking = this.costMultitasking.bind(this)
          this.costPythonScript = this.costPythonScript.bind(this)

          window.setInterval(this.tick, 1000);
        }

        buyLegalPad () {
            const cost = this.costLegalPad()
            if (this.state.productivityCount >= cost) {
              this.setState((currentState) => {
                return {
                  productivityCount: this.state.productivityCount - cost,
                  legalPadsCount: currentState.legalPadsCount + 1
                }
              })
            }
        }

        costLegalPad () {
          return this.state.legalPadsCount + 1
        }

        buyTodoApp () {
            const cost = this.costTodoApp()
            if (this.state.productivityCount >= cost) {
              this.setState((currentState) => {
                return {
                  productivityCount: this.state.productivityCount - cost,
                  todoAppsCount: currentState.todoAppsCount + 1
                }
              })
            }
        }

        costTodoApp () {
          return this.state.todoAppsCount * 35 + 35
        }

        buyPythonScript () {
            const cost = this.costPythonScript()
            if (this.state.productivityCount >= cost) {
              this.setState((currentState) => {
                return {
                  productivityCount: this.state.productivityCount - cost,
                  pythonScriptsCount: currentState.pythonScriptsCount + 1
                }
              })
            }
        }

        costPythonScript () {
          return 3500 * this.state.pythonScriptsCount + 1000
        }

        buyMultitasking () {
            const cost = this.costMultitasking()
            if (this.state.productivityCount >= cost) {
              this.setState((currentState) => {
                return {
                  productivityCount: this.state.productivityCount - cost,
                  multitaskingCount: currentState.multitaskingCount + 1
                }
              })
            }
        }

        costMultitasking () {
          return 50 * this.state.multitaskingCount * this.state.multitaskingCount + 100
        }

        click () {
          const conversion = Math.min(1 + this.state.multitaskingCount ** 2, this.state.tasksCount)
          this.setState((currentState) => {
            return {
              tasksCount: currentState.tasksCount - conversion,
              productivityCount: currentState.productivityCount + conversion,
            }
          })
        }

        tick () {
          this.setState((currentState) => {
            return {
              tasksCount: currentState.tasksCount + 1 + currentState.legalPadsCount + 5 * currentState.todoAppsCount,
              productivityCount: currentState.productivityCount + currentState.pythonScriptsCount ** 3
            }
          })
        }

        render () {
          return (
          <div className="app-container">

            <StatsPanel
              tasksCount = {this.state.tasksCount}
              productivityCount = {this.state.productivityCount}
              legalPadsCount = {this.state.legalPadsCount}
              todoAppsCount = {this.state.todoAppsCount}
              pythonScriptsCount = {this.state.pythonScriptsCount}
              multitaskingCount = {this.state.multitaskingCount}
              click = {this.click}
              />

            <UpgradePanel
              buyLegalPad = {this.buyLegalPad}
              buyTodoApp = {this.buyTodoApp}
              buyPythonScript = {this.buyPythonScript}
              buyMultitasking = {this.buyMultitasking}
              costLegalPad = {this.costLegalPad}
              costTodoApp = {this.costTodoApp}
              costPythonScript = {this.costPythonScript}
              costMultitasking = {this.costMultitasking}
            />
          </div>
          )
        }
      }

      ReactDOM.render(
        <App />,
        document.getElementById('app')
      )
    </script>
    <div id="app"></app>
  </body>

</html>
