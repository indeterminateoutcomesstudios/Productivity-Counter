<html>
<head>

  <style>
  div {
    margin-top: 1em;
  }
  </style>

  <script>
  var ticker = window.setInterval(tick, 100);
  var startTime = new Date();
  var endTime = null;
  var numTodos = 0;
  var productivity = 999990;
  var legalPads = 0;
  var todoApps = 0;
  var pythonScripts = 0;
  var clumsyMultitasking = 0;
  var gameFinished = false;

  function tick () {
    console.log("tick");
    updateDisplay();
    updateModel();
  }

  // manual controls
  function userClick () {
    if (numTodos > 0) {
      if (numTodos > 5 * clumsyMultitasking * clumsyMultitasking + 1) {
        numTodos -= 5 * clumsyMultitasking * clumsyMultitasking + 1;
        productivity += 5 * clumsyMultitasking + 1;
      } else {
        numTodos = 0;
      }
    }
    updateDisplay();
  }

  function buyLegalPad () {
    if (productivity >= legalPads) {
      productivity -= legalPads;
      legalPads += 1;
    }
    updateDisplay();
  }

  function buyTodoApp () {
    if (productivity >= todoApps * 35) {
      productivity -= todoApps * 35;
      todoApps += 1;
    }
    updateDisplay();
  }

  function buyPythonScript () {
    if (productivity >= 3500 * pythonScripts * pythonScripts + 3500) {
      productivity -= 3500 * pythonScripts * pythonScripts + 3500;
      pythonScripts += 1;
    }
    updateDisplay();
  }

  function buyClumsyMultitasking () {
    if (productivity >= 100 * clumsyMultitasking * clumsyMultitasking + 100) {
      productivity -= 100 * clumsyMultitasking * clumsyMultitasking + 100;
      clumsyMultitasking += 1;
    }
    updateDisplay();
  }

  // update displays
  function updateDisplay () {
    displayNumTodos();
    displayProductivity();
    displayLegalPads();
    displayTodoApps();
    displayPythonScripts();
    displayClumsyMultitasking();
    displayWinGame();
  }

  function displayNumTodos () {
    let newString = numTodos + " todos";
    document.getElementById("numTodos").innerText = newString;
  }

  function displayProductivity () {
    let newString = productivity + " productivity points";
    document.getElementById("productivity").innerText = newString;
  }

  function displayLegalPads () {
    let newString = legalPads + " legal pads";
    document.getElementById("legalPads").innerText = newString;
    document.getElementById("legalPadButton").disabled = productivity < legalPads;
    document.getElementById("legalPadButton").innerText = "buy a legal pad (" + legalPads + " productivity)";
  }

  function displayTodoApps () {
    let newString = todoApps + " todo apps";
    document.getElementById("todoApps").innerText = newString;
    document.getElementById("todoAppButton").disabled = productivity < todoApps * 35;
    document.getElementById("todoAppButton").innerText = "install a todo app (" + todoApps * 35 + " productivity)";
  }

  function displayPythonScripts () {
    let newString = pythonScripts + " python scripts";
    document.getElementById("pythonScripts").innerText = newString;
    document.getElementById("pythonScriptButton").disabled = productivity < 3500 * pythonScripts * pythonScripts + 3500;
    document.getElementById("pythonScriptButton").innerText = "write a python app (" + (3500 * pythonScripts * pythonScripts + 3500) + " productivity)";
  }

  function displayClumsyMultitasking () {
    let newString = "level " + clumsyMultitasking + " of clumsy multitasking";
    document.getElementById("clumsyMultitasking").innerText = newString;
    document.getElementById("clumsyMultitaskingButton").disabled = productivity < 100 * clumsyMultitasking * clumsyMultitasking + 100;
    document.getElementById("clumsyMultitaskingButton").innerText = "level up clumsy multitasking (" + (100 * clumsyMultitasking * clumsyMultitasking + 100) + " productivity)";
  }

  function displayWinGame () {
    document.getElementById("winGameButton").disabled = productivity < 1000000;
  }

  // update model
  function updateModel () {
    incrementTodos();
    incrementProductivity();
  }

  function incrementTodos () {
    numTodos++;
    numTodos += legalPads;
    numTodos += todoApps * 5;
  }

  function incrementProductivity () {
    if (productivity > 0) {
        let increment = Math.min(Math.floor(Math.log(productivity)) * pythonScripts, numTodos);
        productivity += increment;
        numTodos -= increment;
    }
  }

  // endgame
  function winGame () {
    if (productivity >= 1000000) {
      clearInterval(ticker);
      var totalTime = (new Date() - startTime);
      console.log(totalTime);
      var totalSeconds = Math.floor(totalTime / 1000);
      var totalMinutes = Math.floor(totalSeconds / 60);
      totalSeconds %= 60;
      var totalHours = Math.floor(totalMinutes / 60);
      totalMinutes %= 60;

      document.getElementById("game-announcement").innerText = "YOU WERE SO PRODUCTIVE! NOW GO DO REAL WORK <3"
      document.getElementById("game-announcement-footer").innerText = "YOU FINISHED IN " + totalHours + " HOURS " + totalMinutes + " MINUTES " + totalSeconds + " SECONDS"
    }
  }
  </script>
</head>

<body>
  <div id="numTodos"></div>
  <div id="productivity"></div>
  <button onclick="userClick()">complete task(s)</button>

  <div>
    <div><b>Todo Generators</b></div>
    <div>
      <div id="legalPads"></div>
      <button id="legalPadButton" onclick="buyLegalPad()"></button>
    </div>
    <div>
      <div id="todoApps"></div>
      <button id="todoAppButton" onclick="buyTodoApp()"></button>
    </div>
  </div>

  <div>
    <div><b>Productivity Booststers</b></div>
    <div>
      <div id="pythonScripts"></div>
      <button id="pythonScriptButton" onclick="buyPythonScript()"></button>
    </div>
  </div>

  <div>
    <div><b>Productivity Skills</b></div>
    <div>
      <div id="clumsyMultitasking"></div>
      <button id="clumsyMultitaskingButton" onclick="buyClumsyMultitasking()"></button>
    </div>
  </div>

  <div>
    <br />
    <button id="winGameButton" onclick="winGame()">win game (1,000,000 productivity)</button>
  </div>

  <div id="game-announcement" style="font-weight: largest"></div>
  <div id="game-announcement-footer" style="font-weight: largest"></div>

</body>

</html>
